{"version":3,"sources":["../../../../../../node_modules/.pnpm/next%4016.1.2_%40babel%2Bcore%407.28.5_react-dom%4019.2.3_react%4019.2.3__react%4019.2.3/node_modules/next/src/client/components/http-access-fallback/http-access-fallback.ts","../../../../../../node_modules/.pnpm/next%4016.1.2_%40babel%2Bcore%407.28.5_react-dom%4019.2.3_react%4019.2.3__react%4019.2.3/node_modules/next/src/client/components/redirect-status-code.ts","../../../../../../node_modules/.pnpm/next%4016.1.2_%40babel%2Bcore%407.28.5_react-dom%4019.2.3_react%4019.2.3__react%4019.2.3/node_modules/next/src/client/components/redirect-error.ts","../../../../../../node_modules/.pnpm/next%4016.1.2_%40babel%2Bcore%407.28.5_react-dom%4019.2.3_react%4019.2.3__react%4019.2.3/node_modules/next/src/client/components/is-next-router-error.ts","../../../../../../apps/krafta/lib/catalogs/data.ts","../../../../../../apps/krafta/.next-internal/server/app/preview/%5B...slug%5D/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export const HTTPAccessErrorStatus = {\n  NOT_FOUND: 404,\n  FORBIDDEN: 403,\n  UNAUTHORIZED: 401,\n}\n\nconst ALLOWED_CODES = new Set(Object.values(HTTPAccessErrorStatus))\n\nexport const HTTP_ERROR_FALLBACK_ERROR_CODE = 'NEXT_HTTP_ERROR_FALLBACK'\n\nexport type HTTPAccessFallbackError = Error & {\n  digest: `${typeof HTTP_ERROR_FALLBACK_ERROR_CODE};${string}`\n}\n\n/**\n * Checks an error to determine if it's an error generated by\n * the HTTP navigation APIs `notFound()`, `forbidden()` or `unauthorized()`.\n *\n * @param error the error that may reference a HTTP access error\n * @returns true if the error is a HTTP access error\n */\nexport function isHTTPAccessFallbackError(\n  error: unknown\n): error is HTTPAccessFallbackError {\n  if (\n    typeof error !== 'object' ||\n    error === null ||\n    !('digest' in error) ||\n    typeof error.digest !== 'string'\n  ) {\n    return false\n  }\n  const [prefix, httpStatus] = error.digest.split(';')\n\n  return (\n    prefix === HTTP_ERROR_FALLBACK_ERROR_CODE &&\n    ALLOWED_CODES.has(Number(httpStatus))\n  )\n}\n\nexport function getAccessFallbackHTTPStatus(\n  error: HTTPAccessFallbackError\n): number {\n  const httpStatus = error.digest.split(';')[1]\n  return Number(httpStatus)\n}\n\nexport function getAccessFallbackErrorTypeByStatus(\n  status: number\n): 'not-found' | 'forbidden' | 'unauthorized' | undefined {\n  switch (status) {\n    case 401:\n      return 'unauthorized'\n    case 403:\n      return 'forbidden'\n    case 404:\n      return 'not-found'\n    default:\n      return\n  }\n}\n","export enum RedirectStatusCode {\n  SeeOther = 303,\n  TemporaryRedirect = 307,\n  PermanentRedirect = 308,\n}\n","import { RedirectStatusCode } from './redirect-status-code'\n\nexport const REDIRECT_ERROR_CODE = 'NEXT_REDIRECT'\n\nexport enum RedirectType {\n  push = 'push',\n  replace = 'replace',\n}\n\nexport type RedirectError = Error & {\n  digest: `${typeof REDIRECT_ERROR_CODE};${RedirectType};${string};${RedirectStatusCode};`\n}\n\n/**\n * Checks an error to determine if it's an error generated by the\n * `redirect(url)` helper.\n *\n * @param error the error that may reference a redirect error\n * @returns true if the error is a redirect error\n */\nexport function isRedirectError(error: unknown): error is RedirectError {\n  if (\n    typeof error !== 'object' ||\n    error === null ||\n    !('digest' in error) ||\n    typeof error.digest !== 'string'\n  ) {\n    return false\n  }\n\n  const digest = error.digest.split(';')\n  const [errorCode, type] = digest\n  const destination = digest.slice(2, -2).join(';')\n  const status = digest.at(-2)\n\n  const statusCode = Number(status)\n\n  return (\n    errorCode === REDIRECT_ERROR_CODE &&\n    (type === 'replace' || type === 'push') &&\n    typeof destination === 'string' &&\n    !isNaN(statusCode) &&\n    statusCode in RedirectStatusCode\n  )\n}\n","import {\n  isHTTPAccessFallbackError,\n  type HTTPAccessFallbackError,\n} from './http-access-fallback/http-access-fallback'\nimport { isRedirectError, type RedirectError } from './redirect-error'\n\n/**\n * Returns true if the error is a navigation signal error. These errors are\n * thrown by user code to perform navigation operations and interrupt the React\n * render.\n */\nexport function isNextRouterError(\n  error: unknown\n): error is RedirectError | HTTPAccessFallbackError {\n  return isRedirectError(error) || isHTTPAccessFallbackError(error)\n}\n","// lib/catalogs/data.ts\nimport { cacheTag } from \"next/cache\";\nimport type { Catalog, CategoryWithItems, Item, CatalogCategory } from \"./types\";\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  throw new Error(\"Missing Supabase environment variables.\");\n}\n\nconst supabaseHeaders = {\n  apikey: supabaseAnonKey,\n  Authorization: `Bearer ${supabaseAnonKey}`,\n};\n\nexport async function getCatalogBySlug(\n  slug: string\n): Promise<Catalog | null> {\n  \"use cache\";\n  cacheTag(`catalog:${slug}`, \"catalogs\");\n\n  const url = `${supabaseUrl}/rest/v1/catalogs?slug=eq.${encodeURIComponent(\n    slug,\n  )}&select=*`;\n  const response = await fetch(url, {\n    headers: supabaseHeaders,\n    next: {\n      tags: [`catalog:${slug}`, \"catalogs\"],\n    },\n    cache: \"force-cache\",\n  });\n\n  if (!response.ok) return null;\n  const data = (await response.json()) as Catalog[];\n  const catalog = data[0] ?? null;\n  if (catalog?.id) {\n    cacheTag(`catalog:${catalog.id}`);\n  }\n  return catalog;\n}\n\nexport async function getCatalogStructure(\n  catalogId: string\n): Promise<CategoryWithItems[]> {\n  \"use cache\";\n  cacheTag(`catalog:${catalogId}`, `catalog-structure:${catalogId}`);\n\n  const categoriesUrl = `${supabaseUrl}/rest/v1/catalog_categories?catalog_id=eq.${encodeURIComponent(\n    catalogId,\n  )}&is_active=eq.true&select=*&order=position.asc`;\n  const itemsUrl = `${supabaseUrl}/rest/v1/items?catalog_id=eq.${encodeURIComponent(\n    catalogId,\n  )}&is_active=eq.true&select=*&order=position.asc`;\n\n  const [categoriesResponse, itemsResponse] = await Promise.all([\n    fetch(categoriesUrl, {\n      headers: supabaseHeaders,\n      next: {\n        tags: [`catalog:${catalogId}`, `catalog-structure:${catalogId}`],\n      },\n      cache: \"force-cache\",\n    }),\n    fetch(itemsUrl, {\n      headers: supabaseHeaders,\n      next: {\n        tags: [`catalog:${catalogId}`, `catalog-structure:${catalogId}`],\n      },\n      cache: \"force-cache\",\n    }),\n  ]);\n\n  if (!categoriesResponse.ok) return [];\n  const categories = (await categoriesResponse.json()) as CatalogCategory[];\n\n  if (!itemsResponse.ok) {\n    return categories.map((category) => ({\n      ...category,\n      items: [],\n    }));\n  }\n  const items = (await itemsResponse.json()) as Item[];\n\n  const itemsByCategory = new Map<string, Item[]>();\n  for (const item of items) {\n    const list = itemsByCategory.get(item.category_id) ?? [];\n    list.push(item);\n    itemsByCategory.set(item.category_id, list);\n  }\n\n  return categories.map((category) => ({\n    ...category,\n    items: itemsByCategory.get(category.id) ?? [],\n  }));\n}\n","export {$$RSC_SERVER_CACHE_0 as 'c0611dc6a5681bb4412dfda78e34745b9a6ae84010'} from 'ACTIONS_MODULE0'\nexport {$$RSC_SERVER_CACHE_1 as 'c09c6fb5a83fb2f73507c066d40fb710f559db9b35'} from 'ACTIONS_MODULE0'\n"],"names":["HTTPAccessErrorStatus","HTTP_ERROR_FALLBACK_ERROR_CODE","getAccessFallbackErrorTypeByStatus","getAccessFallbackHTTPStatus","isHTTPAccessFallbackError","NOT_FOUND","FORBIDDEN","UNAUTHORIZED","ALLOWED_CODES","Set","Object","values","error","digest","prefix","httpStatus","split","has","Number","status","RedirectStatusCode","REDIRECT_ERROR_CODE","RedirectType","isRedirectError","errorCode","type","destination","slice","join","at","statusCode","isNaN","isNextRouterError"],"mappings":"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","ignoreList":[0,1,2,3]}