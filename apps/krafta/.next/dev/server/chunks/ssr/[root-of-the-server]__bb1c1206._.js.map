{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///Users/bakh/VSCode/krafta/apps/krafta/lib/catalogs/data.ts"],"sourcesContent":["// lib/catalogs/data.ts\nimport { cacheTag } from \"next/cache\";\nimport type { Catalog, CategoryWithItems, Item, CatalogCategory } from \"./types\";\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  throw new Error(\"Missing Supabase environment variables.\");\n}\n\nconst supabaseHeaders = {\n  apikey: supabaseAnonKey,\n  Authorization: `Bearer ${supabaseAnonKey}`,\n};\n\nexport async function getCatalogBySlug(\n  slug: string\n): Promise<Catalog | null> {\n  \"use cache\";\n  cacheTag(`catalog:${slug}`, \"catalogs\");\n\n  const url = `${supabaseUrl}/rest/v1/catalogs?slug=eq.${encodeURIComponent(\n    slug,\n  )}&select=*`;\n  const response = await fetch(url, {\n    headers: supabaseHeaders,\n    next: {\n      tags: [`catalog:${slug}`, \"catalogs\"],\n    },\n    cache: \"force-cache\",\n  });\n\n  if (!response.ok) return null;\n  const data = (await response.json()) as Catalog[];\n  const catalog = data[0] ?? null;\n  if (catalog?.id) {\n    cacheTag(`catalog:${catalog.id}`);\n  }\n  return catalog;\n}\n\nexport async function getCatalogStructure(\n  catalogId: string\n): Promise<CategoryWithItems[]> {\n  \"use cache\";\n  cacheTag(`catalog:${catalogId}`, `catalog-structure:${catalogId}`);\n\n  const categoriesUrl = `${supabaseUrl}/rest/v1/catalog_categories?catalog_id=eq.${encodeURIComponent(\n    catalogId,\n  )}&is_active=eq.true&select=*&order=position.asc`;\n  const itemsUrl = `${supabaseUrl}/rest/v1/items?catalog_id=eq.${encodeURIComponent(\n    catalogId,\n  )}&is_active=eq.true&select=*&order=position.asc`;\n\n  const [categoriesResponse, itemsResponse] = await Promise.all([\n    fetch(categoriesUrl, {\n      headers: supabaseHeaders,\n      next: {\n        tags: [`catalog:${catalogId}`, `catalog-structure:${catalogId}`],\n      },\n      cache: \"force-cache\",\n    }),\n    fetch(itemsUrl, {\n      headers: supabaseHeaders,\n      next: {\n        tags: [`catalog:${catalogId}`, `catalog-structure:${catalogId}`],\n      },\n      cache: \"force-cache\",\n    }),\n  ]);\n\n  if (!categoriesResponse.ok) return [];\n  const categories = (await categoriesResponse.json()) as CatalogCategory[];\n\n  if (!itemsResponse.ok) {\n    return categories.map((category) => ({\n      ...category,\n      items: [],\n    }));\n  }\n  const items = (await itemsResponse.json()) as Item[];\n\n  const itemsByCategory = new Map<string, Item[]>();\n  for (const item of items) {\n    const list = itemsByCategory.get(item.category_id) ?? [];\n    list.push(item);\n    itemsByCategory.set(item.category_id, list);\n  }\n\n  return categories.map((category) => ({\n    ...category,\n    items: itemsByCategory.get(category.id) ?? [],\n  }));\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;AAAA,uBAAuB;kMACvB;;;;;AAGA,MAAM;AACN,MAAM;AAEN;;AAIA,MAAM,kBAAkB;IACtB,QAAQ;IACR,eAAe,CAAC,OAAO,EAAE,iBAAiB;AAC5C;AAEO,MAAA,6BAAA,eAAe,iBACpB,IAAY;IAGZ,IAAA,0SAAQ,EAAC,CAAC,QAAQ,EAAE,MAAM,EAAE;IAE5B,MAAM,MAAM,GAAG,YAAY,0BAA0B,EAAE,mBACrD,MACA,SAAS,CAAC;IACZ,MAAM,WAAW,MAAM,MAAM,KAAK;QAChC,SAAS;QACT,MAAM;YACJ,MAAM;gBAAC,CAAC,QAAQ,EAAE,MAAM;gBAAE;aAAW;QACvC;QACA,OAAO;IACT;IAEA,IAAI,CAAC,SAAS,EAAE,EAAE,OAAO;IACzB,MAAM,OAAQ,MAAM,SAAS,IAAI;IACjC,MAAM,UAAU,IAAI,CAAC,EAAE,IAAI;IAC3B,IAAI,SAAS,IAAI;QACf,IAAA,0SAAQ,EAAC,CAAC,QAAQ,EAAE,QAAQ,EAAE,EAAE;IAClC;IACA,OAAO;AACT;IAxBO,4YAAA,SAAe;WAAf;;AAAA;;;;IAAe;AA0Bf,MAAA,6BAAA,eAAe,oBACpB,SAAiB;IAGjB,IAAA,0SAAQ,EAAC,CAAC,QAAQ,EAAE,WAAW,EAAE,CAAC,kBAAkB,EAAE,WAAW;IAEjE,MAAM,gBAAgB,GAAG,YAAY,0CAA0C,EAAE,mBAC/E,WACA,8CAA8C,CAAC;IACjD,MAAM,WAAW,GAAG,YAAY,6BAA6B,EAAE,mBAC7D,WACA,8CAA8C,CAAC;IAEjD,MAAM,CAAC,oBAAoB,cAAc,GAAG,MAAM,QAAQ,GAAG,CAAC;QAC5D,MAAM,eAAe;YACnB,SAAS;YACT,MAAM;gBACJ,MAAM;oBAAC,CAAC,QAAQ,EAAE,WAAW;oBAAE,CAAC,kBAAkB,EAAE,WAAW;iBAAC;YAClE;YACA,OAAO;QACT;QACA,MAAM,UAAU;YACd,SAAS;YACT,MAAM;gBACJ,MAAM;oBAAC,CAAC,QAAQ,EAAE,WAAW;oBAAE,CAAC,kBAAkB,EAAE,WAAW;iBAAC;YAClE;YACA,OAAO;QACT;KACD;IAED,IAAI,CAAC,mBAAmB,EAAE,EAAE,OAAO,EAAE;IACrC,MAAM,aAAc,MAAM,mBAAmB,IAAI;IAEjD,IAAI,CAAC,cAAc,EAAE,EAAE;QACrB,OAAO,WAAW,GAAG,CAAC,CAAC,WAAa,CAAC;gBACnC,GAAG,QAAQ;gBACX,OAAO,EAAE;YACX,CAAC;IACH;IACA,MAAM,QAAS,MAAM,cAAc,IAAI;IAEvC,MAAM,kBAAkB,IAAI;IAC5B,KAAK,MAAM,QAAQ,MAAO;QACxB,MAAM,OAAO,gBAAgB,GAAG,CAAC,KAAK,WAAW,KAAK,EAAE;QACxD,KAAK,IAAI,CAAC;QACV,gBAAgB,GAAG,CAAC,KAAK,WAAW,EAAE;IACxC;IAEA,OAAO,WAAW,GAAG,CAAC,CAAC,WAAa,CAAC;YACnC,GAAG,QAAQ;YACX,OAAO,gBAAgB,GAAG,CAAC,SAAS,EAAE,KAAK,EAAE;QAC/C,CAAC;AACH;IApDO,4YAAA,SAAe;WAAf;;AAAA;;;;IAAe"}},
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///Users/bakh/VSCode/krafta/apps/krafta/.next-internal/server/app/%5B...slug%5D/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {$$RSC_SERVER_CACHE_1 as 'c0c3e5afe23eb71387252db3207eed35ea3d10697d'} from 'ACTIONS_MODULE0'\nexport {$$RSC_SERVER_CACHE_0 as 'c0fa5cab4f6f207b8c2bf0d80864298b7ce2099224'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}