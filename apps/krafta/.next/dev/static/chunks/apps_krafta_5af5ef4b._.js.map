{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/bakh/VSCode/krafta/apps/krafta/components/ui/aspect-ratio.tsx"],"sourcesContent":["\"use client\"\n\nimport * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nfunction AspectRatio({\n  ...props\n}: React.ComponentProps<typeof AspectRatioPrimitive.Root>) {\n  return <AspectRatioPrimitive.Root data-slot=\"aspect-ratio\" {...props} />\n}\n\nexport { AspectRatio }\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAIA,SAAS,YAAY,EACnB,GAAG,OACoD;IACvD,qBAAO,8VAAC,0YAAyB;QAAC,aAAU;QAAgB,GAAG,KAAK;;;;;;AACtE;KAJS"}},
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///Users/bakh/VSCode/krafta/apps/krafta/components/ui/drawer.tsx"],"sourcesContent":["\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction Drawer({\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) {\n  return <DrawerPrimitive.Root data-slot=\"drawer\" {...props} />\n}\n\nfunction DrawerTrigger({\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Trigger>) {\n  return <DrawerPrimitive.Trigger data-slot=\"drawer-trigger\" {...props} />\n}\n\nfunction DrawerPortal({\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Portal>) {\n  return <DrawerPrimitive.Portal data-slot=\"drawer-portal\" {...props} />\n}\n\nfunction DrawerClose({\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Close>) {\n  return <DrawerPrimitive.Close data-slot=\"drawer-close\" {...props} />\n}\n\nfunction DrawerOverlay({\n  className,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Overlay>) {\n  return (\n    <DrawerPrimitive.Overlay\n      data-slot=\"drawer-overlay\"\n      className={cn(\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction DrawerContent({\n  className,\n  children,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Content>) {\n  return (\n    <DrawerPortal data-slot=\"drawer-portal\">\n      <DrawerOverlay />\n      <DrawerPrimitive.Content\n        data-slot=\"drawer-content\"\n        className={cn(\n          \"group/drawer-content bg-background fixed z-50 flex h-auto flex-col\",\n          \"data-[vaul-drawer-direction=top]:inset-x-0 data-[vaul-drawer-direction=top]:top-0 data-[vaul-drawer-direction=top]:mb-24 data-[vaul-drawer-direction=top]:max-h-[80vh] data-[vaul-drawer-direction=top]:rounded-b-lg data-[vaul-drawer-direction=top]:border-b\",\n          \"data-[vaul-drawer-direction=bottom]:inset-x-0 data-[vaul-drawer-direction=bottom]:bottom-0 data-[vaul-drawer-direction=bottom]:mt-24 data-[vaul-drawer-direction=bottom]:max-h-[80vh] data-[vaul-drawer-direction=bottom]:rounded-t-lg data-[vaul-drawer-direction=bottom]:border-t\",\n          \"data-[vaul-drawer-direction=right]:inset-y-0 data-[vaul-drawer-direction=right]:right-0 data-[vaul-drawer-direction=right]:w-3/4 data-[vaul-drawer-direction=right]:border-l data-[vaul-drawer-direction=right]:sm:max-w-sm\",\n          \"data-[vaul-drawer-direction=left]:inset-y-0 data-[vaul-drawer-direction=left]:left-0 data-[vaul-drawer-direction=left]:w-3/4 data-[vaul-drawer-direction=left]:border-r data-[vaul-drawer-direction=left]:sm:max-w-sm\",\n          className\n        )}\n        {...props}\n      >\n        <div className=\"bg-muted mx-auto mt-4 hidden h-2 w-[100px] shrink-0 rounded-full group-data-[vaul-drawer-direction=bottom]/drawer-content:block\" />\n        {children}\n      </DrawerPrimitive.Content>\n    </DrawerPortal>\n  )\n}\n\nfunction DrawerHeader({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"drawer-header\"\n      className={cn(\n        \"flex flex-col gap-0.5 p-4 group-data-[vaul-drawer-direction=bottom]/drawer-content:text-center group-data-[vaul-drawer-direction=top]/drawer-content:text-center md:gap-1.5 md:text-left\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\n\nfunction DrawerFooter({ className, ...props }: React.ComponentProps<\"div\">) {\n  return (\n    <div\n      data-slot=\"drawer-footer\"\n      className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction DrawerTitle({\n  className,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Title>) {\n  return (\n    <DrawerPrimitive.Title\n      data-slot=\"drawer-title\"\n      className={cn(\"text-foreground font-semibold\", className)}\n      {...props}\n    />\n  )\n}\n\nfunction DrawerDescription({\n  className,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Description>) {\n  return (\n    <DrawerPrimitive.Description\n      data-slot=\"drawer-description\"\n      className={cn(\"text-muted-foreground text-sm\", className)}\n      {...props}\n    />\n  )\n}\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAGA;AAEA;AALA;;;;AAOA,SAAS,OAAO,EACd,GAAG,OAC+C;IAClD,qBAAO,8VAAC,mYAAe,CAAC,IAAI;QAAC,aAAU;QAAU,GAAG,KAAK;;;;;;AAC3D;KAJS;AAMT,SAAS,cAAc,EACrB,GAAG,OACkD;IACrD,qBAAO,8VAAC,mYAAe,CAAC,OAAO;QAAC,aAAU;QAAkB,GAAG,KAAK;;;;;;AACtE;MAJS;AAMT,SAAS,aAAa,EACpB,GAAG,OACiD;IACpD,qBAAO,8VAAC,mYAAe,CAAC,MAAM;QAAC,aAAU;QAAiB,GAAG,KAAK;;;;;;AACpE;MAJS;AAMT,SAAS,YAAY,EACnB,GAAG,OACgD;IACnD,qBAAO,8VAAC,mYAAe,CAAC,KAAK;QAAC,aAAU;QAAgB,GAAG,KAAK;;;;;;AAClE;MAJS;AAMT,SAAS,cAAc,EACrB,SAAS,EACT,GAAG,OACkD;IACrD,qBACE,8VAAC,mYAAe,CAAC,OAAO;QACtB,aAAU;QACV,WAAW,IAAA,uIAAE,EACX,0JACA;QAED,GAAG,KAAK;;;;;;AAGf;MAdS;AAgBT,SAAS,cAAc,EACrB,SAAS,EACT,QAAQ,EACR,GAAG,OACkD;IACrD,qBACE,8VAAC;QAAa,aAAU;;0BACtB,8VAAC;;;;;0BACD,8VAAC,mYAAe,CAAC,OAAO;gBACtB,aAAU;gBACV,WAAW,IAAA,uIAAE,EACX,sEACA,kQACA,uRACA,+NACA,yNACA;gBAED,GAAG,KAAK;;kCAET,8VAAC;wBAAI,WAAU;;;;;;oBACd;;;;;;;;;;;;;AAIT;MAzBS;AA2BT,SAAS,aAAa,EAAE,SAAS,EAAE,GAAG,OAAoC;IACxE,qBACE,8VAAC;QACC,aAAU;QACV,WAAW,IAAA,uIAAE,EACX,4LACA;QAED,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,aAAa,EAAE,SAAS,EAAE,GAAG,OAAoC;IACxE,qBACE,8VAAC;QACC,aAAU;QACV,WAAW,IAAA,uIAAE,EAAC,mCAAmC;QAChD,GAAG,KAAK;;;;;;AAGf;MARS;AAUT,SAAS,YAAY,EACnB,SAAS,EACT,GAAG,OACgD;IACnD,qBACE,8VAAC,mYAAe,CAAC,KAAK;QACpB,aAAU;QACV,WAAW,IAAA,uIAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGf;MAXS;AAaT,SAAS,kBAAkB,EACzB,SAAS,EACT,GAAG,OACsD;IACzD,qBACE,8VAAC,mYAAe,CAAC,WAAW;QAC1B,aAAU;QACV,WAAW,IAAA,uIAAE,EAAC,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGf;MAXS"}},
    {"offset": {"line": 222, "column": 0}, "map": {"version":3,"sources":["file:///Users/bakh/VSCode/krafta/apps/krafta/lib/catalogs/settings/currency.ts"],"sourcesContent":["export type CurrencyLabelPosition = \"prefix\" | \"suffix\";\n\nexport type ThousandSeparator = \",\" | \".\" | \" \";\n\nexport type DecimalSeparator = \".\" | \",\";\n\nexport type CurrencySettings = {\n  defaultCurrency: string;\n  label: string;\n  thousandSeparator: ThousandSeparator;\n  decimalSeparator: DecimalSeparator;\n  showDecimals: boolean;\n  labelPosition: CurrencyLabelPosition;\n};\n\nexport const defaultCurrencySettings: CurrencySettings = {\n  defaultCurrency: \"USD\",\n  label: \"$\",\n  thousandSeparator: \",\",\n  decimalSeparator: \".\",\n  showDecimals: true,\n  labelPosition: \"prefix\",\n};\n\nfunction normalizeSeparator(\n  raw: unknown,\n  fallback: ThousandSeparator,\n): ThousandSeparator {\n  if (raw === \",\" || raw === \".\" || raw === \" \") return raw;\n  return fallback;\n}\n\nfunction normalizeDecimalSeparator(\n  raw: unknown,\n  fallback: DecimalSeparator,\n): DecimalSeparator {\n  if (raw === \".\" || raw === \",\") return raw;\n  return fallback;\n}\n\nfunction normalizeLabelPosition(\n  raw: unknown,\n  fallback: CurrencyLabelPosition,\n): CurrencyLabelPosition {\n  if (raw === \"prefix\" || raw === \"suffix\") return raw;\n  return fallback;\n}\n\nfunction normalizeLabel(raw: unknown, fallback: string): string {\n  if (typeof raw === \"string\") return raw;\n  return fallback;\n}\n\nexport function normalizeCurrencySettings(\n  raw: Partial<CurrencySettings> | Record<string, unknown> = {},\n): CurrencySettings {\n  const typed = raw as Partial<CurrencySettings>;\n  const defaultCurrency =\n    typeof typed.defaultCurrency === \"string\" && typed.defaultCurrency.trim()\n      ? typed.defaultCurrency\n      : defaultCurrencySettings.defaultCurrency;\n\n  return {\n    defaultCurrency,\n    label: normalizeLabel(typed.label, defaultCurrencySettings.label),\n    thousandSeparator: normalizeSeparator(\n      typed.thousandSeparator,\n      defaultCurrencySettings.thousandSeparator,\n    ),\n    decimalSeparator: normalizeDecimalSeparator(\n      typed.decimalSeparator,\n      defaultCurrencySettings.decimalSeparator,\n    ),\n    showDecimals:\n      typeof typed.showDecimals === \"boolean\"\n        ? typed.showDecimals\n        : defaultCurrencySettings.showDecimals,\n    labelPosition: normalizeLabelPosition(\n      typed.labelPosition,\n      defaultCurrencySettings.labelPosition,\n    ),\n  };\n}\n"],"names":[],"mappings":";;;;;;AAeO,MAAM,0BAA4C;IACvD,iBAAiB;IACjB,OAAO;IACP,mBAAmB;IACnB,kBAAkB;IAClB,cAAc;IACd,eAAe;AACjB;AAEA,SAAS,mBACP,GAAY,EACZ,QAA2B;IAE3B,IAAI,QAAQ,OAAO,QAAQ,OAAO,QAAQ,KAAK,OAAO;IACtD,OAAO;AACT;AAEA,SAAS,0BACP,GAAY,EACZ,QAA0B;IAE1B,IAAI,QAAQ,OAAO,QAAQ,KAAK,OAAO;IACvC,OAAO;AACT;AAEA,SAAS,uBACP,GAAY,EACZ,QAA+B;IAE/B,IAAI,QAAQ,YAAY,QAAQ,UAAU,OAAO;IACjD,OAAO;AACT;AAEA,SAAS,eAAe,GAAY,EAAE,QAAgB;IACpD,IAAI,OAAO,QAAQ,UAAU,OAAO;IACpC,OAAO;AACT;AAEO,SAAS,0BACd,MAA2D,CAAC,CAAC;IAE7D,MAAM,QAAQ;IACd,MAAM,kBACJ,OAAO,MAAM,eAAe,KAAK,YAAY,MAAM,eAAe,CAAC,IAAI,KACnE,MAAM,eAAe,GACrB,wBAAwB,eAAe;IAE7C,OAAO;QACL;QACA,OAAO,eAAe,MAAM,KAAK,EAAE,wBAAwB,KAAK;QAChE,mBAAmB,mBACjB,MAAM,iBAAiB,EACvB,wBAAwB,iBAAiB;QAE3C,kBAAkB,0BAChB,MAAM,gBAAgB,EACtB,wBAAwB,gBAAgB;QAE1C,cACE,OAAO,MAAM,YAAY,KAAK,YAC1B,MAAM,YAAY,GAClB,wBAAwB,YAAY;QAC1C,eAAe,uBACb,MAAM,aAAa,EACnB,wBAAwB,aAAa;IAEzC;AACF"}},
    {"offset": {"line": 271, "column": 0}, "map": {"version":3,"sources":["file:///Users/bakh/VSCode/krafta/apps/krafta/lib/catalogs/pricing.ts"],"sourcesContent":["import {\n  type CurrencySettings,\n  defaultCurrencySettings,\n} from \"@/lib/catalogs/settings/currency\";\n\nfunction applyThousandsSeparator(value: string, separator: string): string {\n  if (!separator) return value;\n\n  const isNegative = value.startsWith(\"-\");\n  const digits = isNegative ? value.slice(1) : value;\n  const parts: string[] = [];\n\n  for (let i = digits.length; i > 0; i -= 3) {\n    const start = Math.max(i - 3, 0);\n    parts.unshift(digits.slice(start, i));\n  }\n\n  return `${isNegative ? \"-\" : \"\"}${parts.join(separator)}`;\n}\n\nexport function formatPriceCents(\n  amountCents: number,\n  settings?: CurrencySettings,\n): string {\n  const currency = settings ?? defaultCurrencySettings;\n  const decimals = currency.showDecimals ? 2 : 0;\n  const value = amountCents / 100;\n  const rounded =\n    decimals === 0 ? Math.round(value) : value;\n  const fixed = rounded.toFixed(decimals);\n  const [rawInteger, rawFraction] = fixed.split(\".\");\n\n  const integer = applyThousandsSeparator(\n    rawInteger,\n    currency.thousandSeparator,\n  );\n  const number = currency.showDecimals\n    ? `${integer}${currency.decimalSeparator}${rawFraction ?? \"00\"}`\n    : integer;\n\n  const label = currency.label ?? \"\";\n  if (!label) return number;\n\n  return currency.labelPosition === \"suffix\"\n    ? `${number} ${label}`\n    : `${label} ${number}`;\n}\n"],"names":[],"mappings":";;;;AAAA;;AAKA,SAAS,wBAAwB,KAAa,EAAE,SAAiB;IAC/D,IAAI,CAAC,WAAW,OAAO;IAEvB,MAAM,aAAa,MAAM,UAAU,CAAC;IACpC,MAAM,SAAS,aAAa,MAAM,KAAK,CAAC,KAAK;IAC7C,MAAM,QAAkB,EAAE;IAE1B,IAAK,IAAI,IAAI,OAAO,MAAM,EAAE,IAAI,GAAG,KAAK,EAAG;QACzC,MAAM,QAAQ,KAAK,GAAG,CAAC,IAAI,GAAG;QAC9B,MAAM,OAAO,CAAC,OAAO,KAAK,CAAC,OAAO;IACpC;IAEA,OAAO,GAAG,aAAa,MAAM,KAAK,MAAM,IAAI,CAAC,YAAY;AAC3D;AAEO,SAAS,iBACd,WAAmB,EACnB,QAA2B;IAE3B,MAAM,WAAW,YAAY,uLAAuB;IACpD,MAAM,WAAW,SAAS,YAAY,GAAG,IAAI;IAC7C,MAAM,QAAQ,cAAc;IAC5B,MAAM,UACJ,aAAa,IAAI,KAAK,KAAK,CAAC,SAAS;IACvC,MAAM,QAAQ,QAAQ,OAAO,CAAC;IAC9B,MAAM,CAAC,YAAY,YAAY,GAAG,MAAM,KAAK,CAAC;IAE9C,MAAM,UAAU,wBACd,YACA,SAAS,iBAAiB;IAE5B,MAAM,SAAS,SAAS,YAAY,GAChC,GAAG,UAAU,SAAS,gBAAgB,GAAG,eAAe,MAAM,GAC9D;IAEJ,MAAM,QAAQ,SAAS,KAAK,IAAI;IAChC,IAAI,CAAC,OAAO,OAAO;IAEnB,OAAO,SAAS,aAAa,KAAK,WAC9B,GAAG,OAAO,CAAC,EAAE,OAAO,GACpB,GAAG,MAAM,CAAC,EAAE,QAAQ;AAC1B"}},
    {"offset": {"line": 308, "column": 0}, "map": {"version":3,"sources":["file:///Users/bakh/VSCode/krafta/apps/krafta/components/catalogs/items/item-detail-fullscreen-view.tsx"],"sourcesContent":[" \"use client\";\n\nimport Image from \"next/image\";\nimport Link from \"next/link\";\nimport { Share2, XIcon } from \"lucide-react\";\nimport { AspectRatio } from \"@/components/ui/aspect-ratio\";\nimport { Button } from \"@/components/ui/button\";\nimport { toast } from \"sonner\";\nimport type { ItemDetailProps } from \"@/lib/catalogs/layout-registry\";\nimport { formatPriceCents } from \"@/lib/catalogs/pricing\";\n\nexport function ItemDetailFullscreen({\n  item,\n  category,\n  imageUrl,\n  itemAspectRatio,\n  backHref,\n  onClose,\n  currencySettings,\n}: ItemDetailProps) {\n  const ratio = itemAspectRatio ?? 4 / 5;\n  const handleShare = async () => {\n    if (typeof window === \"undefined\") return;\n\n    const url = window.location.href;\n\n    if (navigator.clipboard?.writeText) {\n      try {\n        await navigator.clipboard.writeText(url);\n        toast(\"Link copied\", {\n          description: \"Paste it anywhere to share this item.\",\n        });\n        return;\n      } catch {\n        // fall through to legacy copy\n      }\n    }\n\n    try {\n      const input = document.createElement(\"input\");\n      input.value = url;\n      input.setAttribute(\"readonly\", \"true\");\n      input.style.position = \"absolute\";\n      input.style.left = \"-9999px\";\n      document.body.appendChild(input);\n      input.select();\n      document.execCommand(\"copy\");\n      document.body.removeChild(input);\n      toast(\"Link copied\", {\n        description: \"Paste it anywhere to share this item.\",\n      });\n    } catch {\n      toast.error(\"Unable to copy link\");\n    }\n  };\n\n  return (\n    <div className=\"mx-auto flex h-dvh w-full max-w-[480px] flex-col overflow-y-auto bg-background text-foreground md:h-[85dvh] md:rounded-sm md:shadow-xl\">\n      <div className=\"relative\">\n        {imageUrl && (\n          <AspectRatio ratio={ratio} className=\"bg-muted\">\n            <Image\n              src={imageUrl}\n              alt={item.image_alt ?? item.name}\n              fill\n              className=\"h-full w-full object-cover\"\n            />\n          </AspectRatio>\n        )}\n\n        <div className=\"pointer-events-none absolute inset-x-0 bottom-0 h-2/3 bg-linear-to-t from-black/90 via-black/50 to-transparent\" />\n\n        <div className=\"fixed inset-x-5 top-5 z-10 flex items-center justify-between text-white/80 md:absolute\">\n          <Button\n            type=\"button\"\n            variant=\"ghost\"\n            size=\"icon-lg\"\n            onClick={handleShare}\n            className=\"h-11 w-11 rounded-full border border-white/20 bg-black/20 text-white backdrop-blur-md hover:bg-black/30\"\n            aria-label=\"Share\"\n          >\n            <Share2 className=\"size-5\" />\n          </Button>\n          {onClose ? (\n            <Button\n              type=\"button\"\n              variant=\"ghost\"\n              size=\"icon-lg\"\n              onClick={onClose}\n              className=\"h-11 w-11 rounded-full border border-white/20 bg-black/20 text-white backdrop-blur-md hover:bg-black/30\"\n              aria-label=\"Close\"\n            >\n              <XIcon className=\"size-6\" />\n            </Button>\n          ) : (\n            <Button\n              asChild\n              variant=\"ghost\"\n              size=\"icon-lg\"\n              className=\"h-11 w-11 rounded-full border border-white/20 bg-black/20 text-white backdrop-blur-md hover:bg-black/30\"\n            >\n              <Link href={backHref ?? \"#\"} aria-label=\"Close\">\n                <XIcon className=\"size-6\" />\n              </Link>\n            </Button>\n          )}\n        </div>\n\n        <div className=\"absolute inset-x-5 bottom-4 space-y-2 text-white\">\n          {category && (\n            <p className=\"text-[11px] uppercase tracking-[0.2em] text-white/70\">\n              {category.name}\n            </p>\n          )}\n          <h2 className=\"text-3xl font-semibold leading-tight\">\n            {item.name}\n          </h2>\n        </div>\n      </div>\n\n      <div className=\"flex-1 px-5 pb-28 pt-4\">\n        <div className=\"mt-2 space-y-3\">\n          <p className=\"text-3xl font-semibold text-foreground\">\n            {formatPriceCents(item.price_cents, currencySettings)}\n          </p>\n          <p className=\"text-sm text-muted-foreground\">\n            {item.description ??\n              \"A detail view designed for immersive browsing. You can add ingredients, preparation notes, or rich storytelling here later.\"}\n          </p>\n        </div>\n\n      </div>\n\n      <div className=\"fixed inset-x-0 bottom-0 z-10 w-full border-t border-border/60 bg-background/95 backdrop-blur md:sticky\">\n        <div className=\"mx-auto flex w-full max-w-2xl flex-col gap-3 px-5 py-4\">\n          {onClose ? (\n            <Button\n              type=\"button\"\n              variant=\"outline\"\n              onClick={onClose}\n              className=\"w-full border-border/60 text-foreground hover:bg-muted/40\"\n            >\n              Закрыть\n            </Button>\n          ) : (\n            <Button\n              asChild\n              variant=\"outline\"\n              className=\"w-full border-border/60 text-foreground hover:bg-muted/40\"\n            >\n              <Link href={backHref ?? \"#\"}>Закрыть</Link>\n            </Button>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 587, "column": 0}, "map": {"version":3,"sources":["file:///Users/bakh/VSCode/krafta/apps/krafta/components/catalogs/navbars/category-nav-tabs.tsx"],"sourcesContent":["// components/catalogs/navbars/category-nav-tabs.tsx\n\"use client\";\n\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport type { CategoryNavProps } from \"@/lib/catalogs/layout-registry\";\nimport { cn } from \"@/lib/utils\";\n\nconst TOP_OFFSET_PX = 60;\nconst ALL_SCROLL_Y = 100;\nconst UNLOCK_FALLBACK_MS = 800;\n\ntype SectionEntry = { slug: string; el: HTMLElement };\n\nfunction getSlug(category: { slug: string | null; id: string }) {\n  return category.slug ?? String(category.id);\n}\n\nfunction getInitialActiveSlug(\n  categories: CategoryNavProps[\"categories\"],\n  activeCategoryId: string | null,\n  activeCategorySlug: string | null,\n) {\n  const fromId =\n    categories.find((category) => category.id === activeCategoryId)?.slug ??\n    null;\n  const slugValid = activeCategorySlug\n    ? categories.some(\n        (category) => getSlug(category) === activeCategorySlug,\n      )\n    : false;\n  return slugValid ? activeCategorySlug : fromId;\n}\n\nfunction useStickySentinel(id: string) {\n  const [isStuck, setIsStuck] = useState(false);\n\n  useEffect(() => {\n    const sentinel = document.getElementById(id);\n    if (!sentinel) return;\n\n    const observer = new IntersectionObserver(\n      ([entry]) => setIsStuck(!entry.isIntersecting),\n      { threshold: 0 },\n    );\n\n    observer.observe(sentinel);\n    return () => observer.disconnect();\n  }, [id]);\n\n  return isStuck;\n}\n\nfunction useScrollLock(timeoutMs: number) {\n  const lockRef = useRef(false);\n  const unlockTimerRef = useRef<number | null>(null);\n\n  const lock = useCallback(() => {\n    lockRef.current = true;\n    if (unlockTimerRef.current !== null) {\n      window.clearTimeout(unlockTimerRef.current);\n    }\n    unlockTimerRef.current = window.setTimeout(() => {\n      lockRef.current = false;\n      unlockTimerRef.current = null;\n    }, timeoutMs);\n  }, [timeoutMs]);\n\n  useEffect(() => {\n    return () => {\n      if (unlockTimerRef.current !== null) {\n        window.clearTimeout(unlockTimerRef.current);\n      }\n    };\n  }, []);\n\n  return { lockRef, lock };\n}\n\nfunction useCenterActiveTab(\n  navRef: React.RefObject<HTMLDivElement | null>,\n  activeSlug: string | null,\n) {\n  useEffect(() => {\n    const nav = navRef.current;\n    if (!nav) return;\n\n    const slug = activeSlug ?? \"all\";\n    const activeButton = nav.querySelector<HTMLElement>(\n      `[data-category=\"${slug}\"]`,\n    );\n    if (!activeButton) return;\n\n    const containerWidth = nav.clientWidth;\n    const maxScrollLeft = nav.scrollWidth - containerWidth;\n    if (maxScrollLeft <= 0) return;\n\n    const targetCenter =\n      activeButton.offsetLeft +\n      activeButton.offsetWidth / 2 -\n      containerWidth / 2;\n    const next = Math.min(Math.max(targetCenter, 0), maxScrollLeft);\n\n    if (Math.abs(nav.scrollLeft - next) < 2) return;\n    nav.scrollTo({ left: next, behavior: \"smooth\" });\n  }, [activeSlug, navRef]);\n}\n\nfunction useScrollActiveCategory(\n  slugs: string[],\n  setActive: (slug: string | null) => void,\n  lockRef: React.MutableRefObject<boolean>,\n) {\n  useEffect(() => {\n    const entries: SectionEntry[] = [];\n    for (const slug of slugs) {\n      const el = document.getElementById(`category-${slug}`);\n      if (el) entries.push({ slug, el });\n    }\n\n    if (!entries.length) return;\n\n    const ratios = new Map<string, number>();\n    let raf = 0;\n\n    const pickBest = () => {\n      raf = 0;\n      if (lockRef.current) return;\n\n      if (window.scrollY <= ALL_SCROLL_Y) {\n        setActive(null);\n        return;\n      }\n\n      let bestSlug: string | null = null;\n      let bestRatio = 0;\n\n      for (const { slug } of entries) {\n        const r = ratios.get(slug) ?? 0;\n        if (r > bestRatio) {\n          bestRatio = r;\n          bestSlug = slug;\n        }\n      }\n\n      if (bestSlug) setActive(bestSlug);\n    };\n\n    const observer = new IntersectionObserver(\n      (obsEntries) => {\n        for (const entry of obsEntries) {\n          const slug = (entry.target as HTMLElement).id.replace(\n            /^category-/,\n            \"\",\n          );\n          ratios.set(slug, entry.intersectionRatio);\n        }\n        if (raf) return;\n        raf = window.requestAnimationFrame(pickBest);\n      },\n      {\n        root: null,\n        rootMargin: `-${TOP_OFFSET_PX}px 0px -40% 0px`,\n        threshold: [0, 0.1, 0.25, 0.5, 0.75, 1],\n      },\n    );\n\n    for (const { el } of entries) observer.observe(el);\n    pickBest();\n\n    return () => {\n      observer.disconnect();\n      if (raf) window.cancelAnimationFrame(raf);\n    };\n  }, [lockRef, setActive, slugs]);\n}\n\nexport function CategoryNavTabs({\n  categories,\n  activeCategoryId = null,\n  activeCategorySlug = null,\n  baseHref,\n}: CategoryNavProps) {\n  if (!categories.length) return null;\n\n  const normalizedBase = useMemo(\n    () => baseHref.replace(/\\/+$/, \"\") || \"/\",\n    [baseHref],\n  );\n\n  const slugs = useMemo(\n    () => categories.map(getSlug),\n    [categories],\n  );\n\n  const initialActiveSlug = useMemo(\n    () =>\n      getInitialActiveSlug(\n        categories,\n        activeCategoryId,\n        activeCategorySlug,\n      ),\n    [activeCategoryId, activeCategorySlug, categories],\n  );\n\n  const [currentSlug, setCurrentSlug] = useState<string | null>(\n    initialActiveSlug,\n  );\n  const lastActiveRef = useRef<string | null>(null);\n  const navRef = useRef<HTMLDivElement | null>(null);\n  const { lockRef, lock } = useScrollLock(UNLOCK_FALLBACK_MS);\n  const isStuck = useStickySentinel(\"catalog-category-nav-sentinel\");\n\n  const buildPath = useCallback(\n    (slug: string | null) =>\n      slug ? `${normalizedBase}/${slug}` : normalizedBase,\n    [normalizedBase],\n  );\n\n  const setActive = useCallback((slug: string | null) => {\n    if (lastActiveRef.current === slug) return;\n    lastActiveRef.current = slug;\n    setCurrentSlug((prev) => (prev === slug ? prev : slug));\n  }, []);\n\n  const scrollToCategory = useCallback((slug: string | null) => {\n    if (!slug) {\n      window.scrollTo({ top: 0, behavior: \"smooth\" });\n      return;\n    }\n\n    const el = document.getElementById(`category-${slug}`);\n    if (!el) return;\n\n    const y =\n      el.getBoundingClientRect().top +\n      window.scrollY -\n      TOP_OFFSET_PX;\n    window.scrollTo({ top: y, behavior: \"smooth\" });\n  }, []);\n\n  const handleCategoryClick = useCallback(\n    (slug: string | null) => {\n      lock();\n      setActive(slug);\n      scrollToCategory(slug);\n      window.history.replaceState(null, \"\", buildPath(slug));\n    },\n    [buildPath, lock, scrollToCategory, setActive],\n  );\n\n  useEffect(() => {\n    setCurrentSlug((prev) =>\n      prev === initialActiveSlug ? prev : initialActiveSlug,\n    );\n    lastActiveRef.current = initialActiveSlug;\n  }, [initialActiveSlug]);\n\n  useEffect(() => {\n    if (!activeCategorySlug) return;\n    const handle = window.requestAnimationFrame(() => {\n      scrollToCategory(activeCategorySlug);\n    });\n    return () => window.cancelAnimationFrame(handle);\n  }, [activeCategorySlug, scrollToCategory]);\n\n  useCenterActiveTab(navRef, currentSlug);\n  useScrollActiveCategory(slugs, setActive, lockRef);\n\n  return (\n    <>\n      <div\n        id=\"catalog-category-nav-sentinel\"\n        aria-hidden=\"true\"\n        className=\"h-px\"\n      />\n\n      <div\n        className={cn(\n          \"sticky top-0 z-30 -mx-4 bg-background/90 dark:bg-secondary-background/90 backdrop-blur\",\n          isStuck ? \"border-b border-border\" : \"border-b border-transparent\",\n        )}\n      >\n        <nav\n          ref={navRef}\n          className=\"no-scrollbar flex gap-2 overflow-x-auto pb-2 pt-2 px-4\"\n        >\n          <button\n            type=\"button\"\n            data-category=\"all\"\n            onClick={() => handleCategoryClick(null)}\n            className={cn(\n              \"whitespace-nowrap rounded-xs border px-3 py-1 text-sm transition\",\n              currentSlug === null\n                ? \"border-foreground bg-foreground text-background\"\n                : \"border-border text-muted-foreground hover:border-foreground hover:text-foreground\",\n            )}\n          >\n            Все\n          </button>\n\n          {categories.map((category) => {\n            const slug = getSlug(category);\n            const isActive = slug === currentSlug;\n\n            return (\n              <button\n                key={category.id}\n                type=\"button\"\n                data-category={slug}\n                onClick={() => handleCategoryClick(slug)}\n                className={cn(\n                  \"whitespace-nowrap rounded-xs border px-3 py-1 text-sm transition\",\n                  isActive\n                    ? \"border-foreground bg-foreground text-background\"\n                    : \"border-border text-muted-foreground hover:border-foreground hover:text-foreground\",\n                )}\n              >\n                {category.name}\n              </button>\n            );\n          })}\n        </nav>\n      </div>\n    </>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 942, "column": 0}, "map": {"version":3,"sources":["file:///Users/bakh/VSCode/krafta/apps/krafta/components/catalogs/navbars/category-nav-tabs-motion.tsx"],"sourcesContent":["// components/catalogs/navbars/category-nav-tabs-motion.tsx\n\"use client\";\n\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { motion } from \"framer-motion\";\nimport type { CategoryNavProps } from \"@/lib/catalogs/layout-registry\";\nimport { cn } from \"@/lib/utils\";\n\nconst TOP_OFFSET_PX = 60;\nconst ALL_SCROLL_Y = 100;\nconst UNLOCK_FALLBACK_MS = 800;\n\ntype SectionEntry = { slug: string; el: HTMLElement };\n\nfunction getSlug(category: { slug: string | null; id: string }) {\n  return category.slug ?? String(category.id);\n}\n\nfunction getInitialActiveSlug(\n  categories: CategoryNavProps[\"categories\"],\n  activeCategoryId: string | null,\n  activeCategorySlug: string | null,\n) {\n  const fromId =\n    categories.find((category) => category.id === activeCategoryId)?.slug ??\n    null;\n  const slugValid = activeCategorySlug\n    ? categories.some(\n        (category) => getSlug(category) === activeCategorySlug,\n      )\n    : false;\n  return slugValid ? activeCategorySlug : fromId;\n}\n\nfunction useStickySentinel(id: string) {\n  const [isStuck, setIsStuck] = useState(false);\n\n  useEffect(() => {\n    const sentinel = document.getElementById(id);\n    if (!sentinel) return;\n\n    const observer = new IntersectionObserver(\n      ([entry]) => setIsStuck(!entry.isIntersecting),\n      { threshold: 0 },\n    );\n\n    observer.observe(sentinel);\n    return () => observer.disconnect();\n  }, [id]);\n\n  return isStuck;\n}\n\nfunction useScrollLock(timeoutMs: number) {\n  const lockRef = useRef(false);\n  const unlockTimerRef = useRef<number | null>(null);\n\n  const lock = useCallback(() => {\n    lockRef.current = true;\n    if (unlockTimerRef.current !== null) {\n      window.clearTimeout(unlockTimerRef.current);\n    }\n    unlockTimerRef.current = window.setTimeout(() => {\n      lockRef.current = false;\n      unlockTimerRef.current = null;\n    }, timeoutMs);\n  }, [timeoutMs]);\n\n  useEffect(() => {\n    return () => {\n      if (unlockTimerRef.current !== null) {\n        window.clearTimeout(unlockTimerRef.current);\n      }\n    };\n  }, []);\n\n  return { lockRef, lock };\n}\n\nfunction useCenterActiveTab(\n  navRef: React.RefObject<HTMLDivElement | null>,\n  activeSlug: string | null,\n) {\n  useEffect(() => {\n    const nav = navRef.current;\n    if (!nav) return;\n\n    const slug = activeSlug ?? \"all\";\n    const activeButton = nav.querySelector<HTMLElement>(\n      `[data-category=\"${slug}\"]`,\n    );\n    if (!activeButton) return;\n\n    const containerWidth = nav.clientWidth;\n    const maxScrollLeft = nav.scrollWidth - containerWidth;\n    if (maxScrollLeft <= 0) return;\n\n    const targetCenter =\n      activeButton.offsetLeft +\n      activeButton.offsetWidth / 2 -\n      containerWidth / 2;\n    const next = Math.min(Math.max(targetCenter, 0), maxScrollLeft);\n\n    if (Math.abs(nav.scrollLeft - next) < 2) return;\n    nav.scrollTo({ left: next, behavior: \"smooth\" });\n  }, [activeSlug, navRef]);\n}\n\nfunction useScrollActiveCategory(\n  slugs: string[],\n  setActive: (slug: string | null) => void,\n  lockRef: React.MutableRefObject<boolean>,\n) {\n  useEffect(() => {\n    const entries: SectionEntry[] = [];\n    for (const slug of slugs) {\n      const el = document.getElementById(`category-${slug}`);\n      if (el) entries.push({ slug, el });\n    }\n\n    if (!entries.length) return;\n\n    const ratios = new Map<string, number>();\n    let raf = 0;\n\n    const pickBest = () => {\n      raf = 0;\n      if (lockRef.current) return;\n\n      if (window.scrollY <= ALL_SCROLL_Y) {\n        setActive(null);\n        return;\n      }\n\n      let bestSlug: string | null = null;\n      let bestRatio = 0;\n\n      for (const { slug } of entries) {\n        const r = ratios.get(slug) ?? 0;\n        if (r > bestRatio) {\n          bestRatio = r;\n          bestSlug = slug;\n        }\n      }\n\n      if (bestSlug) setActive(bestSlug);\n    };\n\n    const observer = new IntersectionObserver(\n      (obsEntries) => {\n        for (const entry of obsEntries) {\n          const slug = (entry.target as HTMLElement).id.replace(\n            /^category-/,\n            \"\",\n          );\n          ratios.set(slug, entry.intersectionRatio);\n        }\n        if (raf) return;\n        raf = window.requestAnimationFrame(pickBest);\n      },\n      {\n        root: null,\n        rootMargin: `-${TOP_OFFSET_PX}px 0px -40% 0px`,\n        threshold: [0, 0.1, 0.25, 0.5, 0.75, 1],\n      },\n    );\n\n    for (const { el } of entries) observer.observe(el);\n    pickBest();\n\n    return () => {\n      observer.disconnect();\n      if (raf) window.cancelAnimationFrame(raf);\n    };\n  }, [lockRef, setActive, slugs]);\n}\n\nexport function CategoryNavTabsMotion({\n  categories,\n  activeCategoryId = null,\n  activeCategorySlug = null,\n  baseHref,\n}: CategoryNavProps) {\n  if (!categories.length) return null;\n\n  const normalizedBase = useMemo(\n    () => baseHref.replace(/\\/+$/, \"\") || \"/\",\n    [baseHref],\n  );\n\n  const slugs = useMemo(\n    () => categories.map(getSlug),\n    [categories],\n  );\n\n  const initialActiveSlug = useMemo(\n    () =>\n      getInitialActiveSlug(\n        categories,\n        activeCategoryId,\n        activeCategorySlug,\n      ),\n    [activeCategoryId, activeCategorySlug, categories],\n  );\n\n  const [currentSlug, setCurrentSlug] = useState<string | null>(\n    initialActiveSlug,\n  );\n  const lastActiveRef = useRef<string | null>(null);\n  const navRef = useRef<HTMLDivElement | null>(null);\n  const { lockRef, lock } = useScrollLock(UNLOCK_FALLBACK_MS);\n  const isStuck = useStickySentinel(\"catalog-category-nav-sentinel\");\n\n  const buildPath = useCallback(\n    (slug: string | null) =>\n      slug ? `${normalizedBase}/${slug}` : normalizedBase,\n    [normalizedBase],\n  );\n\n  const setActive = useCallback((slug: string | null) => {\n    if (lastActiveRef.current === slug) return;\n    lastActiveRef.current = slug;\n    setCurrentSlug((prev) => (prev === slug ? prev : slug));\n  }, []);\n\n  const scrollToCategory = useCallback((slug: string | null) => {\n    if (!slug) {\n      window.scrollTo({ top: 0, behavior: \"smooth\" });\n      return;\n    }\n\n    const el = document.getElementById(`category-${slug}`);\n    if (!el) return;\n\n    const y =\n      el.getBoundingClientRect().top +\n      window.scrollY -\n      TOP_OFFSET_PX;\n    window.scrollTo({ top: y, behavior: \"smooth\" });\n  }, []);\n\n  const handleCategoryClick = useCallback(\n    (slug: string | null) => {\n      lock();\n      setActive(slug);\n      scrollToCategory(slug);\n      window.history.replaceState(null, \"\", buildPath(slug));\n    },\n    [buildPath, lock, scrollToCategory, setActive],\n  );\n\n  useEffect(() => {\n    setCurrentSlug((prev) =>\n      prev === initialActiveSlug ? prev : initialActiveSlug,\n    );\n    lastActiveRef.current = initialActiveSlug;\n  }, [initialActiveSlug]);\n\n  useEffect(() => {\n    if (!activeCategorySlug) return;\n    const handle = window.requestAnimationFrame(() => {\n      scrollToCategory(activeCategorySlug);\n    });\n    return () => window.cancelAnimationFrame(handle);\n  }, [activeCategorySlug, scrollToCategory]);\n\n  useCenterActiveTab(navRef, currentSlug);\n  useScrollActiveCategory(slugs, setActive, lockRef);\n\n  const activeSlug = currentSlug ?? \"all\";\n\n  return (\n    <>\n      <div\n        id=\"catalog-category-nav-sentinel\"\n        aria-hidden=\"true\"\n        className=\"h-px\"\n      />\n\n      <div\n        className={cn(\n          \"sticky top-0 z-30 -mx-4 bg-background/90 dark:bg-secondary-background/90 backdrop-blur\",\n          isStuck ? \"border-b border-border\" : \"border-b border-transparent\",\n        )}\n      >\n        <nav\n          ref={navRef}\n          className=\"no-scrollbar flex gap-2 overflow-x-auto pb-2 pt-2 px-4\"\n        >\n          {[\n            { id: \"all\", label: \"Все\", slug: null as string | null },\n            ...categories.map((category) => ({\n              id: category.id,\n              label: category.name,\n              slug: getSlug(category),\n            })),\n          ].map((tab) => {\n            const slugValue = tab.slug ?? \"all\";\n            const isActive = slugValue === activeSlug;\n            return (\n              <button\n                key={tab.id}\n                type=\"button\"\n                data-category={slugValue}\n                onClick={() => handleCategoryClick(tab.slug)}\n                className={cn(\n                  \"relative whitespace-nowrap rounded-xs border px-3 py-1 text-sm transition\",\n                  isActive\n                    ? \"border-transparent text-foreground\"\n                    : \"border-border text-muted-foreground hover:border-foreground hover:text-foreground\",\n                )}\n              >\n                {isActive && (\n                  <motion.span\n                    layoutId=\"catalog-tabs-pill\"\n                    className=\"absolute inset-0 rounded-xs bg-foreground\"\n                    transition={{\n                      type: \"spring\",\n                      stiffness: 380,\n                      damping: 26,\n                      mass: 0.2,\n                    }}\n                  />\n                )}\n                <span\n                  className={cn(\n                    \"relative z-10\",\n                    isActive\n                      ? \"text-background\"\n                      : \"text-muted-foreground\",\n                  )}\n                >\n                  {tab.label}\n                </span>\n              </button>\n            );\n          })}\n        </nav>\n      </div>\n    </>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1321, "column": 0}, "map": {"version":3,"sources":["file:///Users/bakh/VSCode/krafta/apps/krafta/components/catalogs/navbars/category-nav-tabs-dashboard.tsx"],"sourcesContent":["// components/catalogs/navbars/category-nav-tabs-dashboard.tsx\n\"use client\";\n\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport { motion } from \"framer-motion\";\nimport type { CategoryNavProps } from \"@/lib/catalogs/layout-registry\";\nimport { cn } from \"@/lib/utils\";\n\nconst TOP_OFFSET_PX = 60;\nconst ALL_SCROLL_Y = 100;\nconst UNLOCK_FALLBACK_MS = 800;\n\ntype SectionEntry = { slug: string; el: HTMLElement };\n\nfunction getSlug(category: { slug: string | null; id: string }) {\n  return category.slug ?? String(category.id);\n}\n\nfunction getInitialActiveSlug(\n  categories: CategoryNavProps[\"categories\"],\n  activeCategoryId: string | null,\n  activeCategorySlug: string | null,\n) {\n  const fromId =\n    categories.find((category) => category.id === activeCategoryId)?.slug ??\n    null;\n  const slugValid = activeCategorySlug\n    ? categories.some(\n        (category) => getSlug(category) === activeCategorySlug,\n      )\n    : false;\n  return slugValid ? activeCategorySlug : fromId;\n}\n\nfunction useStickySentinel(id: string) {\n  const [isStuck, setIsStuck] = useState(false);\n\n  useEffect(() => {\n    const sentinel = document.getElementById(id);\n    if (!sentinel) return;\n\n    const observer = new IntersectionObserver(\n      ([entry]) => setIsStuck(!entry.isIntersecting),\n      { threshold: 0 },\n    );\n\n    observer.observe(sentinel);\n    return () => observer.disconnect();\n  }, [id]);\n\n  return isStuck;\n}\n\nfunction useScrollLock(timeoutMs: number) {\n  const lockRef = useRef(false);\n  const unlockTimerRef = useRef<number | null>(null);\n\n  const lock = useCallback(() => {\n    lockRef.current = true;\n    if (unlockTimerRef.current !== null) {\n      window.clearTimeout(unlockTimerRef.current);\n    }\n    unlockTimerRef.current = window.setTimeout(() => {\n      lockRef.current = false;\n      unlockTimerRef.current = null;\n    }, timeoutMs);\n  }, [timeoutMs]);\n\n  useEffect(() => {\n    return () => {\n      if (unlockTimerRef.current !== null) {\n        window.clearTimeout(unlockTimerRef.current);\n      }\n    };\n  }, []);\n\n  return { lockRef, lock };\n}\n\nfunction useCenterActiveTab(\n  navRef: React.RefObject<HTMLDivElement | null>,\n  activeSlug: string | null,\n) {\n  useEffect(() => {\n    const nav = navRef.current;\n    if (!nav) return;\n\n    const slug = activeSlug ?? \"all\";\n    const activeButton = nav.querySelector<HTMLElement>(\n      `[data-category=\"${slug}\"]`,\n    );\n    if (!activeButton) return;\n\n    const containerWidth = nav.clientWidth;\n    const maxScrollLeft = nav.scrollWidth - containerWidth;\n    if (maxScrollLeft <= 0) return;\n\n    const targetCenter =\n      activeButton.offsetLeft +\n      activeButton.offsetWidth / 2 -\n      containerWidth / 2;\n    const next = Math.min(Math.max(targetCenter, 0), maxScrollLeft);\n\n    if (Math.abs(nav.scrollLeft - next) < 2) return;\n    nav.scrollTo({ left: next, behavior: \"smooth\" });\n  }, [activeSlug, navRef]);\n}\n\nfunction useScrollActiveCategory(\n  slugs: string[],\n  setActive: (slug: string | null) => void,\n  lockRef: React.MutableRefObject<boolean>,\n) {\n  useEffect(() => {\n    const entries: SectionEntry[] = [];\n    for (const slug of slugs) {\n      const el = document.getElementById(`category-${slug}`);\n      if (el) entries.push({ slug, el });\n    }\n\n    if (!entries.length) return;\n\n    const ratios = new Map<string, number>();\n    let raf = 0;\n\n    const pickBest = () => {\n      raf = 0;\n      if (lockRef.current) return;\n\n      if (window.scrollY <= ALL_SCROLL_Y) {\n        setActive(null);\n        return;\n      }\n\n      let bestSlug: string | null = null;\n      let bestRatio = 0;\n\n      for (const { slug } of entries) {\n        const r = ratios.get(slug) ?? 0;\n        if (r > bestRatio) {\n          bestRatio = r;\n          bestSlug = slug;\n        }\n      }\n\n      if (bestSlug) setActive(bestSlug);\n    };\n\n    const observer = new IntersectionObserver(\n      (obsEntries) => {\n        for (const entry of obsEntries) {\n          const slug = (entry.target as HTMLElement).id.replace(\n            /^category-/,\n            \"\",\n          );\n          ratios.set(slug, entry.intersectionRatio);\n        }\n        if (raf) return;\n        raf = window.requestAnimationFrame(pickBest);\n      },\n      {\n        root: null,\n        rootMargin: `-${TOP_OFFSET_PX}px 0px -40% 0px`,\n        threshold: [0, 0.1, 0.25, 0.5, 0.75, 1],\n      },\n    );\n\n    for (const { el } of entries) observer.observe(el);\n    pickBest();\n\n    return () => {\n      observer.disconnect();\n      if (raf) window.cancelAnimationFrame(raf);\n    };\n  }, [lockRef, setActive, slugs]);\n}\n\nexport function CategoryNavTabsDashboard({\n  categories,\n  activeCategoryId = null,\n  activeCategorySlug = null,\n  baseHref,\n}: CategoryNavProps) {\n  if (!categories.length) return null;\n\n  const normalizedBase = useMemo(\n    () => baseHref.replace(/\\/+$/, \"\") || \"/\",\n    [baseHref],\n  );\n\n  const slugs = useMemo(\n    () => categories.map(getSlug),\n    [categories],\n  );\n\n  const initialActiveSlug = useMemo(\n    () =>\n      getInitialActiveSlug(\n        categories,\n        activeCategoryId,\n        activeCategorySlug,\n      ),\n    [activeCategoryId, activeCategorySlug, categories],\n  );\n\n  const [currentSlug, setCurrentSlug] = useState<string | null>(\n    initialActiveSlug,\n  );\n  const lastActiveRef = useRef<string | null>(null);\n  const navRef = useRef<HTMLDivElement | null>(null);\n  const { lockRef, lock } = useScrollLock(UNLOCK_FALLBACK_MS);\n  const isStuck = useStickySentinel(\"catalog-category-nav-sentinel\");\n\n  const buildPath = useCallback(\n    (slug: string | null) =>\n      slug ? `${normalizedBase}/${slug}` : normalizedBase,\n    [normalizedBase],\n  );\n\n  const setActive = useCallback((slug: string | null) => {\n    if (lastActiveRef.current === slug) return;\n    lastActiveRef.current = slug;\n    setCurrentSlug((prev) => (prev === slug ? prev : slug));\n  }, []);\n\n  const scrollToCategory = useCallback((slug: string | null) => {\n    if (!slug) {\n      window.scrollTo({ top: 0, behavior: \"smooth\" });\n      return;\n    }\n\n    const el = document.getElementById(`category-${slug}`);\n    if (!el) return;\n\n    const y =\n      el.getBoundingClientRect().top +\n      window.scrollY -\n      TOP_OFFSET_PX;\n    window.scrollTo({ top: y, behavior: \"smooth\" });\n  }, []);\n\n  const handleCategoryClick = useCallback(\n    (slug: string | null) => {\n      lock();\n      setActive(slug);\n      scrollToCategory(slug);\n      window.history.replaceState(null, \"\", buildPath(slug));\n    },\n    [buildPath, lock, scrollToCategory, setActive],\n  );\n\n  useEffect(() => {\n    setCurrentSlug((prev) =>\n      prev === initialActiveSlug ? prev : initialActiveSlug,\n    );\n    lastActiveRef.current = initialActiveSlug;\n  }, [initialActiveSlug]);\n\n  useEffect(() => {\n    if (!activeCategorySlug) return;\n    const handle = window.requestAnimationFrame(() => {\n      scrollToCategory(activeCategorySlug);\n    });\n    return () => window.cancelAnimationFrame(handle);\n  }, [activeCategorySlug, scrollToCategory]);\n\n  useCenterActiveTab(navRef, currentSlug);\n  useScrollActiveCategory(slugs, setActive, lockRef);\n\n  const activeSlug = currentSlug ?? \"all\";\n\n  return (\n    <>\n      <div\n        id=\"catalog-category-nav-sentinel \"\n        aria-hidden=\"true\"\n        className=\"h-px\"\n      />\n\n      <div\n        className={cn(\n          \"sticky top-0 z-30 -mx-4 bg-background/90 dark:bg-secondary-background/90 backdrop-blur \",\n          isStuck ? \"border-b border-border\" : \"border-b border-transparent\",\n        )}\n      >\n        <nav\n          ref={navRef}\n          className=\"no-scrollbar flex gap-2 overflow-x-auto pb-2 pt-2 px-4\"\n        >\n          {[\n            { id: \"all\", label: \"Все\", slug: null as string | null },\n            ...categories.map((category) => ({\n              id: category.id,\n              label: category.name,\n              slug: getSlug(category),\n            })),\n          ].map((tab) => {\n            const slugValue = tab.slug ?? \"all\";\n            const isActive = slugValue === activeSlug;\n            return (\n              <button\n                key={tab.id}\n                type=\"button\"\n                data-category={slugValue}\n                onClick={() => handleCategoryClick(tab.slug)}\n                className={cn(\n                  \"relative whitespace-nowrap px-3 py-1 text-sm transition\",\n                  isActive\n                    ? \"text-foreground\"\n                    : \"text-muted-foreground hover:text-foreground\",\n                )}\n              >\n                <motion.span\n                  layoutId={`catalog-tabs-pill-${slugValue}`}\n                  className={cn(\n                    \"absolute inset-y-1 inset-x-0 rounded\",\n                    \n                    isActive ? \"opacity-100\" : \"opacity-0\",\n                  )}\n                  transition={{\n                    type: \"spring\",\n                    stiffness: 380,\n                    damping: 20,\n                    mass: 0.2,\n                  }}\n                />\n                <span\n                  className={cn(\n                    \"relative z-10\",\n                    isActive ? \"text-accent-foreground\" : undefined,\n                  )}\n                >\n                  {tab.label}\n                </span>\n\n                {isActive && (\n                  <motion.span\n                    layoutId=\"catalog-tabs-underline\"\n                    className=\"pointer-events-none absolute -bottom-2 left-1 right-1 h-0.5 rounded bg-foreground\"\n                    transition={{\n                      type: \"spring\",\n                      stiffness: 300,\n                      damping: 22,\n                      mass: 0.2,\n                    }}\n                  />\n                )}\n              </button>\n            );\n          })}\n        </nav>\n      </div>\n    </>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1714, "column": 0}, "map": {"version":3,"sources":["file:///Users/bakh/VSCode/krafta/apps/krafta/components/dashboard/catalog-preview-frame.tsx"],"sourcesContent":["\"use client\";\n\nimport { useMemo, useState } from \"react\";\nimport type { CatalogLayoutSettings } from \"@/lib/catalogs/settings/layout\";\nimport type { CurrencySettings } from \"@/lib/catalogs/settings/currency\";\n\ntype PreviewPreset = {\n  id: string;\n  label: string;\n  width: number | \"100%\";\n  height: number;\n};\n\nconst PREVIEW_PRESETS: PreviewPreset[] = [\n  { id: \"desktop\", label: \"Desktop\", width: \"100%\", height: 780 },\n  { id: \"tablet\", label: \"Tablet\", width: 820, height: 1180 },\n  { id: \"mobile\", label: \"Mobile\", width: 390, height: 844 },\n  { id: \"square\", label: \"Square\", width: 800, height: 800 },\n];\n\nexport function CatalogPreviewFrame({\n  catalogSlug,\n  layoutOverrides,\n  currencyOverrides,\n}: {\n  catalogSlug: string;\n  layoutOverrides?: Partial<CatalogLayoutSettings>;\n  currencyOverrides?: CurrencySettings;\n}) {\n  const [presetId, setPresetId] = useState<string>(\"desktop\");\n  const preset = useMemo(\n    () => PREVIEW_PRESETS.find((item) => item.id === presetId),\n    [presetId],\n  );\n\n  const width =\n    preset?.width ?? PREVIEW_PRESETS[0].width;\n  const height =\n    preset?.height ?? PREVIEW_PRESETS[0].height;\n  const frameStyle = {\n    width: typeof width === \"number\" ? `${width}px` : width,\n    height: `${height}px`,\n  };\n  const iframeSrc = useMemo(() => {\n    const params = new URLSearchParams();\n    params.set(\"preview\", \"1\");\n\n    if (layoutOverrides?.headerVariant) {\n      params.set(\"header\", layoutOverrides.headerVariant);\n    }\n    if (layoutOverrides?.sectionVariant) {\n      params.set(\"section\", layoutOverrides.sectionVariant);\n    }\n    if (layoutOverrides?.itemCardVariant) {\n      params.set(\"card\", layoutOverrides.itemCardVariant);\n    }\n    if (layoutOverrides?.categoryNavVariant) {\n      params.set(\"nav\", layoutOverrides.categoryNavVariant);\n    }\n    if (layoutOverrides?.itemDetailVariant) {\n      params.set(\"detail\", layoutOverrides.itemDetailVariant);\n    }\n    if (layoutOverrides?.itemCard?.columns) {\n      params.set(\"cols\", String(layoutOverrides.itemCard.columns));\n    }\n    if (layoutOverrides?.itemCard?.aspectRatio) {\n      params.set(\"ratio\", String(layoutOverrides.itemCard.aspectRatio));\n    }\n    if (currencyOverrides) {\n      params.set(\"cur\", currencyOverrides.defaultCurrency);\n      params.set(\"curLabel\", currencyOverrides.label);\n      params.set(\"curThousand\", currencyOverrides.thousandSeparator);\n      params.set(\"curDecimal\", currencyOverrides.decimalSeparator);\n      params.set(\"curDecimals\", currencyOverrides.showDecimals ? \"1\" : \"0\");\n      params.set(\"curPos\", currencyOverrides.labelPosition);\n    }\n\n    return `/preview/${catalogSlug}?${params.toString()}`;\n  }, [catalogSlug, layoutOverrides, currencyOverrides]);\n\n  return (\n    <div className=\"mt-6 space-y-4\">\n      <div className=\"flex flex-wrap items-center gap-2\">\n        {PREVIEW_PRESETS.map((item) => (\n          <button\n            key={item.id}\n            type=\"button\"\n            onClick={() => setPresetId(item.id)}\n            className={[\n              \"rounded-full border px-3 py-1 text-xs transition\",\n              presetId === item.id\n                ? \"border-foreground bg-foreground text-background\"\n                : \"border-border text-muted-foreground hover:border-foreground hover:text-foreground\",\n            ].join(\" \")}\n          >\n            {item.label}\n          </button>\n        ))}\n\n        <span className=\"ml-auto text-xs text-muted-foreground\">\n          {typeof width === \"number\" ? `${width}px` : width} × {height}px\n        </span>\n      </div>\n\n      <div className=\"rounded-xl border border-dashed border-border bg-secondary-background/40 p-4\">\n        <div className=\"w-full overflow-auto\">\n          <div\n            className=\"mx-auto overflow-hidden rounded-lg border border-border bg-background shadow-sm\"\n            style={frameStyle}\n          >\n            <iframe\n              title=\"Catalog preview\"\n              src={iframeSrc}\n              className=\"h-full w-full\"\n              loading=\"lazy\"\n              sandbox=\"allow-same-origin allow-scripts allow-forms\"\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1895, "column": 0}, "map": {"version":3,"sources":["file:///Users/bakh/VSCode/krafta/apps/krafta/lib/haptics-client.ts"],"sourcesContent":["\"use client\";\n\ntype TriggerHaptic = (duration?: number) => void;\n\nlet trigger: TriggerHaptic | null = null;\nlet didInit = false;\n\nfunction prefersReducedMotion(): boolean {\n  if (typeof window === \"undefined\") return true;\n  return window.matchMedia?.(\"(prefers-reduced-motion: reduce)\")?.matches ??\n    false;\n}\n\nasync function ensureLoaded() {\n  if (didInit) return;\n  didInit = true;\n\n  if (prefersReducedMotion()) return;\n\n  try {\n    const mod = await import(\"tactus\");\n    trigger = mod.triggerHaptic;\n  } catch {\n    // ignore\n  }\n}\n\nexport async function hapticTap(duration = 40) {\n  await ensureLoaded();\n  trigger?.(duration);\n}\n\nexport async function hapticSuccess() {\n  await hapticTap(70);\n}\n\nexport async function hapticError() {\n  await hapticTap(90);\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;AAIA,IAAI,UAAgC;AACpC,IAAI,UAAU;AAEd,SAAS;IACP;;IACA,OAAO,OAAO,UAAU,GAAG,qCAAqC,WAC9D;AACJ;AAEA,eAAe;IACb,IAAI,SAAS;IACb,UAAU;IAEV,IAAI,wBAAwB;IAE5B,IAAI;QACF,MAAM,MAAM;QACZ,UAAU,IAAI,aAAa;IAC7B,EAAE,OAAM;IACN,SAAS;IACX;AACF;AAEO,eAAe,UAAU,WAAW,EAAE;IAC3C,MAAM;IACN,UAAU;AACZ;AAEO,eAAe;IACpB,MAAM,UAAU;AAClB;AAEO,eAAe;IACpB,MAAM,UAAU;AAClB"}},
    {"offset": {"line": 1939, "column": 0}, "map": {"version":3,"sources":["file:///Users/bakh/VSCode/krafta/apps/krafta/app/dashboard/%5BorgSlug%5D/%5BcatalogSlug%5D/builder/actions.ts"],"sourcesContent":["\"use server\";\n\nimport { updateCatalogByIdAndSlug } from \"@/lib/catalogs/revalidate\";\nimport { createClient } from \"@/lib/supabase/server\";\nimport type { CatalogLayoutSettings } from \"@/lib/catalogs/settings/layout\";\nimport type { CurrencySettings } from \"@/lib/catalogs/settings/currency\";\n\nexport async function saveCatalogLayout(params: {\n  catalogId: string;\n  catalogSlug: string;\n  settingsLayout: CatalogLayoutSettings;\n  settingsCurrency: CurrencySettings;\n}) {\n  const supabase = await createClient();\n\n  const { error } = await supabase\n    .from(\"catalogs\")\n    .update({\n      settings_layout: params.settingsLayout,\n      settings_currency: params.settingsCurrency,\n    })\n    .eq(\"id\", params.catalogId);\n\n  if (error) {\n    return { ok: false, error: error.message };\n  }\n\n  await updateCatalogByIdAndSlug({\n    catalogId: params.catalogId,\n    catalogSlug: params.catalogSlug,\n  });\n\n  return { ok: true };\n}\n"],"names":[],"mappings":";;;;;;;MAOsB,wBAAA,WAAA,GAAA,IAAA,mZAAA,EAAA,8CAAA,wYAAA,EAAA,KAAA,GAAA,8YAAA,EAAA,qDAAA"}},
    {"offset": {"line": 1956, "column": 0}, "map": {"version":3,"sources":["file:///Users/bakh/VSCode/krafta/apps/krafta/components/dashboard/catalog-builder-panel.tsx"],"sourcesContent":["\"use client\";\n\nimport { useMemo, useState } from \"react\";\nimport Link from \"next/link\";\nimport { ArrowUpRight } from \"lucide-react\";\nimport type { CatalogLayoutSettings } from \"@/lib/catalogs/settings/layout\";\nimport type { CurrencySettings } from \"@/lib/catalogs/settings/currency\";\nimport { CatalogPreviewFrame } from \"@/components/dashboard/catalog-preview-frame\";\nimport { Button } from \"@/components/ui/button\";\nimport { toast } from \"sonner\";\nimport { hapticError, hapticSuccess } from \"@/lib/haptics-client\";\nimport { saveCatalogLayout } from \"@/app/dashboard/[orgSlug]/[catalogSlug]/builder/actions\";\n\ntype OptionConfig<T extends string> = {\n  label: string;\n  value: T;\n};\n\ntype AspectPreset = {\n  width: number;\n  height: number;\n};\n\nconst COMMON_ASPECT_RATIOS: AspectPreset[] = [\n  { width: 1, height: 1 },\n  { width: 4, height: 3 },\n  { width: 3, height: 4 },\n  { width: 16, height: 9 },\n  { width: 9, height: 16 },\n];\n\nfunction getAspectInputs(ratio: number): AspectPreset {\n  const safeRatio = Number.isFinite(ratio) && ratio > 0 ? ratio : 1;\n  let bestMatch = COMMON_ASPECT_RATIOS[0];\n  let bestDiff = Infinity;\n\n  for (const preset of COMMON_ASPECT_RATIOS) {\n    const presetRatio = preset.width / preset.height;\n    const diff = Math.abs(presetRatio - safeRatio);\n    if (diff < bestDiff) {\n      bestDiff = diff;\n      bestMatch = preset;\n    }\n  }\n\n  if (bestDiff <= 0.02) {\n    return bestMatch;\n  }\n\n  return {\n    width: Number(safeRatio.toFixed(2)),\n    height: 1,\n  };\n}\n\ntype BuilderPanelProps = {\n  catalogId: string;\n  catalogSlug: string;\n  initialLayout: CatalogLayoutSettings;\n  initialCurrency: CurrencySettings;\n  headerOptions: OptionConfig<CatalogLayoutSettings[\"headerVariant\"]>[];\n  sectionOptions: OptionConfig<CatalogLayoutSettings[\"sectionVariant\"]>[];\n  itemCardOptions: OptionConfig<CatalogLayoutSettings[\"itemCardVariant\"]>[];\n  itemDetailOptions: OptionConfig<CatalogLayoutSettings[\"itemDetailVariant\"]>[];\n  navOptions: OptionConfig<CatalogLayoutSettings[\"categoryNavVariant\"]>[];\n};\n\nexport function CatalogBuilderPanel({\n  catalogId,\n  catalogSlug,\n  initialLayout,\n  initialCurrency,\n  headerOptions,\n  sectionOptions,\n  itemCardOptions,\n  itemDetailOptions,\n  navOptions,\n}: BuilderPanelProps) {\n  const initialAspectInputs = useMemo(\n    () => getAspectInputs(initialLayout.itemCard.aspectRatio),\n    [initialLayout.itemCard.aspectRatio],\n  );\n\n  const [headerVariant, setHeaderVariant] = useState(\n    initialLayout.headerVariant,\n  );\n  const [sectionVariant, setSectionVariant] = useState(\n    initialLayout.sectionVariant,\n  );\n  const [itemCardVariant, setItemCardVariant] = useState(\n    initialLayout.itemCardVariant,\n  );\n  const [categoryNavVariant, setCategoryNavVariant] = useState(\n    initialLayout.categoryNavVariant,\n  );\n  const [itemDetailVariant, setItemDetailVariant] = useState(\n    initialLayout.itemDetailVariant,\n  );\n  const [itemCardColumns, setItemCardColumns] = useState(\n    initialLayout.itemCard.columns,\n  );\n  const [aspectWidth, setAspectWidth] = useState(\n    initialAspectInputs.width,\n  );\n  const [aspectHeight, setAspectHeight] = useState(\n    initialAspectInputs.height,\n  );\n  const [currencyCode, setCurrencyCode] = useState(\n    initialCurrency.defaultCurrency,\n  );\n  const [currencyLabel, setCurrencyLabel] = useState(\n    initialCurrency.label,\n  );\n  const [thousandSeparator, setThousandSeparator] = useState(\n    initialCurrency.thousandSeparator,\n  );\n  const [decimalSeparator, setDecimalSeparator] = useState(\n    initialCurrency.decimalSeparator,\n  );\n  const [showDecimals, setShowDecimals] = useState(\n    initialCurrency.showDecimals,\n  );\n  const [labelPosition, setLabelPosition] = useState(\n    initialCurrency.labelPosition,\n  );\n  const [isSaving, setIsSaving] = useState(false);\n\n  const aspectRatio = useMemo(() => {\n    const safeWidth =\n      Number.isFinite(aspectWidth) && aspectWidth > 0\n        ? aspectWidth\n        : 1;\n    const safeHeight =\n      Number.isFinite(aspectHeight) && aspectHeight > 0\n        ? aspectHeight\n        : 1;\n    return safeWidth / safeHeight;\n  }, [aspectWidth, aspectHeight]);\n\n  const layoutOverrides = useMemo(\n    () => ({\n      headerVariant,\n      sectionVariant,\n      itemCardVariant,\n      categoryNavVariant,\n      itemDetailVariant,\n      itemCard: {\n        columns: itemCardColumns,\n        aspectRatio,\n      },\n    }),\n    [\n      headerVariant,\n      sectionVariant,\n      itemCardVariant,\n      categoryNavVariant,\n      itemDetailVariant,\n      itemCardColumns,\n      aspectRatio,\n    ],\n  );\n  const currencyOverrides = useMemo(\n    () => ({\n      defaultCurrency: currencyCode,\n      label: currencyLabel,\n      thousandSeparator,\n      decimalSeparator,\n      showDecimals,\n      labelPosition,\n    }),\n    [\n      currencyCode,\n      currencyLabel,\n      thousandSeparator,\n      decimalSeparator,\n      showDecimals,\n      labelPosition,\n    ],\n  );\n  const previewHref = useMemo(() => {\n    const params = new URLSearchParams();\n    params.set(\"preview\", \"1\");\n    params.set(\"header\", headerVariant);\n    params.set(\"section\", sectionVariant);\n    params.set(\"card\", itemCardVariant);\n    params.set(\"nav\", categoryNavVariant);\n    params.set(\"detail\", itemDetailVariant);\n    params.set(\"cols\", String(itemCardColumns));\n    params.set(\"ratio\", String(aspectRatio));\n    params.set(\"cur\", currencyCode);\n    params.set(\"curLabel\", currencyLabel);\n    params.set(\"curThousand\", thousandSeparator);\n    params.set(\"curDecimal\", decimalSeparator);\n    params.set(\"curDecimals\", showDecimals ? \"1\" : \"0\");\n    params.set(\"curPos\", labelPosition);\n\n    return `/preview/${catalogSlug}?${params.toString()}`;\n  }, [\n    catalogSlug,\n    headerVariant,\n    sectionVariant,\n    itemCardVariant,\n    categoryNavVariant,\n    itemDetailVariant,\n    itemCardColumns,\n    aspectRatio,\n    currencyCode,\n    currencyLabel,\n    thousandSeparator,\n    decimalSeparator,\n    showDecimals,\n    labelPosition,\n  ]);\n\n  const handleSave = async () => {\n    if (isSaving) return;\n    setIsSaving(true);\n\n    const settingsLayout: CatalogLayoutSettings = {\n      ...initialLayout,\n      headerVariant,\n      sectionVariant,\n      itemCardVariant,\n      categoryNavVariant,\n      itemDetailVariant,\n      itemCard: {\n        columns: itemCardColumns,\n        aspectRatio,\n      },\n    };\n    const settingsCurrency: CurrencySettings = {\n      ...initialCurrency,\n      defaultCurrency: currencyCode,\n      label: currencyLabel,\n      thousandSeparator,\n      decimalSeparator,\n      showDecimals,\n      labelPosition,\n    };\n\n    const result = await saveCatalogLayout({\n      catalogId,\n      catalogSlug,\n      settingsLayout,\n      settingsCurrency,\n    });\n\n    if (!result.ok) {\n      toast.error(\"Failed to save layout\", {\n        description: result.error ?? \"Unknown error\",\n      });\n      void hapticError();\n    } else {\n      toast.success(\"Layout saved\");\n      void hapticSuccess();\n    }\n\n    setIsSaving(false);\n  };\n\n  return (\n    <div className=\"mt-8 grid gap-6 lg:grid-cols-[380px_1fr]\">\n      <aside className=\"space-y-6\">\n        <OptionSection\n          title=\"Headers\"\n          description=\"Top branding and catalog identity.\"\n          options={headerOptions}\n          selected={headerVariant}\n          onSelect={setHeaderVariant}\n        />\n\n        <OptionSection\n          title=\"Sections\"\n          description=\"Category grouping and spacing.\"\n          options={sectionOptions}\n          selected={sectionVariant}\n          onSelect={setSectionVariant}\n        />\n\n        <OptionSection\n          title=\"Item Cards\"\n          description=\"How each item is rendered.\"\n          options={itemCardOptions}\n          selected={itemCardVariant}\n          onSelect={setItemCardVariant}\n        />\n\n        <section className=\"rounded-lg border bg-background p-4\">\n          <h2 className=\"text-sm font-semibold\">Item Card Layout</h2>\n          <p className=\"mt-1 text-xs text-muted-foreground\">\n            Columns and image aspect ratio.\n          </p>\n          <div className=\"mt-4 grid gap-4\">\n            <label className=\"grid gap-2 text-xs text-muted-foreground\">\n              Columns\n              <input\n                type=\"number\"\n                min={1}\n                max={4}\n                step={1}\n                value={itemCardColumns}\n                onChange={(event) => {\n                  const nextValue = Number(event.target.value);\n                  if (!Number.isFinite(nextValue)) return;\n                  const clamped = Math.min(\n                    4,\n                    Math.max(1, Math.round(nextValue)),\n                  );\n                  setItemCardColumns(clamped);\n                }}\n                className=\"rounded-md border border-border bg-background px-3 py-2 text-sm text-foreground\"\n              />\n            </label>\n\n            <div className=\"grid gap-2 text-xs text-muted-foreground\">\n              <span>Aspect ratio</span>\n              <div className=\"grid grid-cols-[1fr_auto_1fr] items-center gap-2\">\n                <input\n                  type=\"number\"\n                  min={0.1}\n                  step={0.1}\n                  value={aspectWidth}\n                  onChange={(event) => {\n                    const nextValue = Number(event.target.value);\n                    if (!Number.isFinite(nextValue)) return;\n                    setAspectWidth(Math.max(0.1, nextValue));\n                  }}\n                  className=\"rounded-md border border-border bg-background px-3 py-2 text-sm text-foreground\"\n                />\n                <span className=\"text-xs text-muted-foreground\">\n                  /\n                </span>\n                <input\n                  type=\"number\"\n                  min={0.1}\n                  step={0.1}\n                  value={aspectHeight}\n                  onChange={(event) => {\n                    const nextValue = Number(event.target.value);\n                    if (!Number.isFinite(nextValue)) return;\n                    setAspectHeight(Math.max(0.1, nextValue));\n                  }}\n                  className=\"rounded-md border border-border bg-background px-3 py-2 text-sm text-foreground\"\n                />\n              </div>\n              <span className=\"text-[11px] text-muted-foreground\">\n                Computed ratio: {aspectRatio.toFixed(3)}\n              </span>\n            </div>\n          </div>\n        </section>\n\n        <OptionSection\n          title=\"Item Detail\"\n          description=\"Full item view when a card is opened.\"\n          options={itemDetailOptions}\n          selected={itemDetailVariant}\n          onSelect={setItemDetailVariant}\n        />\n\n        <section className=\"rounded-lg border bg-background p-4\">\n          <h2 className=\"text-sm font-semibold\">Pricing</h2>\n          <p className=\"mt-1 text-xs text-muted-foreground\">\n            Currency label and formatting for item prices.\n          </p>\n          <div className=\"mt-4 grid gap-4\">\n            <label className=\"grid gap-2 text-xs text-muted-foreground\">\n              Default currency\n              <input\n                type=\"text\"\n                value={currencyCode}\n                onChange={(event) => setCurrencyCode(event.target.value)}\n                className=\"rounded-md border border-border bg-background px-3 py-2 text-sm text-foreground\"\n                placeholder=\"USD\"\n              />\n            </label>\n\n            <label className=\"grid gap-2 text-xs text-muted-foreground\">\n              Currency label\n              <input\n                type=\"text\"\n                value={currencyLabel}\n                onChange={(event) => setCurrencyLabel(event.target.value)}\n                className=\"rounded-md border border-border bg-background px-3 py-2 text-sm text-foreground\"\n                placeholder=\"$\"\n              />\n            </label>\n\n            <div className=\"grid gap-2 text-xs text-muted-foreground\">\n              Label position\n              <div className=\"grid grid-cols-2 gap-2\">\n                {([\"prefix\", \"suffix\"] as const).map((value) => (\n                  <button\n                    key={value}\n                    type=\"button\"\n                    onClick={() => setLabelPosition(value)}\n                    className={[\n                      \"rounded-md border px-3 py-2 text-sm\",\n                      labelPosition === value\n                        ? \"border-foreground bg-foreground text-background\"\n                        : \"border-border text-foreground hover:border-foreground\",\n                    ].join(\" \")}\n                  >\n                    {value === \"prefix\" ? \"Label first\" : \"Label last\"}\n                  </button>\n                ))}\n              </div>\n            </div>\n\n            <div className=\"grid gap-2 text-xs text-muted-foreground\">\n              Thousand separator\n              <div className=\"grid grid-cols-3 gap-2\">\n                {([\",\", \".\", \" \"] as const).map((value) => (\n                  <button\n                    key={value}\n                    type=\"button\"\n                    onClick={() => setThousandSeparator(value)}\n                    className={[\n                      \"rounded-md border px-3 py-2 text-sm\",\n                      thousandSeparator === value\n                        ? \"border-foreground bg-foreground text-background\"\n                        : \"border-border text-foreground hover:border-foreground\",\n                    ].join(\" \")}\n                  >\n                    {value === \" \" ? \"Space\" : value}\n                  </button>\n                ))}\n              </div>\n            </div>\n\n            <div className=\"grid gap-2 text-xs text-muted-foreground\">\n              Decimal separator\n              <div className=\"grid grid-cols-2 gap-2\">\n                {([\".\", \",\"] as const).map((value) => (\n                  <button\n                    key={value}\n                    type=\"button\"\n                    onClick={() => setDecimalSeparator(value)}\n                    className={[\n                      \"rounded-md border px-3 py-2 text-sm\",\n                      decimalSeparator === value\n                        ? \"border-foreground bg-foreground text-background\"\n                        : \"border-border text-foreground hover:border-foreground\",\n                    ].join(\" \")}\n                  >\n                    {value}\n                  </button>\n                ))}\n              </div>\n            </div>\n\n            <label className=\"flex items-center gap-3 text-xs text-muted-foreground\">\n              <input\n                type=\"checkbox\"\n                checked={showDecimals}\n                onChange={(event) => setShowDecimals(event.target.checked)}\n                className=\"h-4 w-4 rounded border-border text-foreground\"\n              />\n              Show decimals\n            </label>\n          </div>\n        </section>\n\n        <OptionSection\n          title=\"Navigation\"\n          description=\"Category navigation style.\"\n          options={navOptions}\n          selected={categoryNavVariant}\n          onSelect={setCategoryNavVariant}\n        />\n      </aside>\n\n      <section className=\"rounded-xl border bg-background p-6\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-sm font-semibold\">Preview</h2>\n            <p className=\"mt-1 text-xs text-muted-foreground\">\n              Live catalog snapshot\n            </p>\n          </div>\n          <div className=\"flex items-center gap-2\">\n            <Button\n              type=\"button\"\n              onClick={handleSave}\n              disabled={isSaving}\n            >\n              {isSaving ? \"Saving...\" : \"Save\"}\n            </Button>\n            <Button\n              asChild\n              variant=\"outline\"\n              size=\"sm\"\n            >\n              <Link\n                href={previewHref}\n                target=\"_blank\"\n                rel=\"noreferrer\"\n              >\n                Preview\n                <ArrowUpRight className=\"size-4\" />\n              </Link>\n            </Button>\n            <span className=\"rounded-full border border-border px-3 py-1 text-[10px] uppercase tracking-wide text-muted-foreground\">\n              Draft\n            </span>\n          </div>\n        </div>\n\n        <CatalogPreviewFrame\n          catalogSlug={catalogSlug}\n          layoutOverrides={layoutOverrides}\n          currencyOverrides={currencyOverrides}\n        />\n      </section>\n    </div>\n  );\n}\n\nfunction OptionSection<T extends string>({\n  title,\n  description,\n  options,\n  selected,\n  onSelect,\n}: {\n  title: string;\n  description: string;\n  options: OptionConfig<T>[];\n  selected: T;\n  onSelect: (value: T) => void;\n}) {\n  return (\n    <section className=\"rounded-lg border bg-background p-4\">\n      <h2 className=\"text-sm font-semibold\">{title}</h2>\n      <p className=\"mt-1 text-xs text-muted-foreground\">\n        {description}\n      </p>\n      <div className=\"mt-4 grid gap-2\">\n        {options.map((option) => (\n          <button\n            key={option.value}\n            type=\"button\"\n            onClick={() => onSelect(option.value)}\n            className={[\n              \"flex items-center justify-between rounded-md border px-3 py-2 text-left text-sm\",\n              option.value === selected\n                ? \"border-foreground bg-foreground text-background\"\n                : \"border-border text-foreground hover:border-foreground\",\n            ].join(\" \")}\n          >\n            <span>{option.label}</span>\n            {option.value === selected ? (\n              <span className=\"rounded-full bg-background/10 px-2 py-0.5 text-[10px] uppercase tracking-wide\">\n                Selected\n              </span>\n            ) : (\n              <span className=\"text-[10px] uppercase tracking-wide text-muted-foreground\">\n                Preview\n              </span>\n            )}\n          </button>\n        ))}\n      </div>\n    </section>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}